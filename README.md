# Tetris_cmd

## 程序简介

以C++编写的使用命令行界面模拟俄罗斯方块的程序。

目前只完成了单人模式的基础部分，~目前代码量约900+行，~优化后代码量约600+行，预计完成项目代码量约1300+行。（双人对战模式令加700+行）

## 运行要求

首次使用时 Windows 8 / 10 需将CMD的“使用旧版控制台”打开，“快速插入”和“快速编辑模式”关闭。运行CMD窗口时关闭输入法。

> 运行环境：Windows 64bit（32bit可自行编译）
>
> 开发环境：
>
> 编辑器：Sublime Text 3
>
> 编译环境：MinGW64 TDM-GCC

## 操作及规则介绍

该程序使用俄罗斯方块SRS旋转规则。
开始界面使用方向上下或W和S键操作光标。
具体规则参见俄罗斯方块游戏规则。
分数计算规则：每次消除n行加(1+2+...+n)分。
Game over判定：顶部两行有放置的方块即为游戏结束。

### 单人模式键位：

- A：左移
- D：右移
- S：下降
- 方向下键：硬降
- 方向左键：左转
- 方向右键：右转


## 已完成内容：

### 单人模式下的：

- 新方块刷新
- 方块的自动下落
- 左移、右移、左转、右转操作
- 下降、硬降操作（下落+移动同时操作时可能有BUG）
- 下落方块检测并刷新新方块
- 整行填满消除的判断
- 最顶行的Game over判断（可能有BUG）
- 操作延迟优化
- 分数计算
- 强制刷新（F8）（对付卡方块BUG的终极解决方法，不过貌似改了下操作代码之后卡方块BUG不会再出现了）

## 待完成内容：

### 单人模式下的：

- 即将出现的后N个方块的缓存区
- HOLD
- 屏幕刷新闪屏双缓存优化
- 天梯榜

### 多人模式下的：

- 双人同时操作的基本功能实现
- 对战分数计算
- 消除行的对方惩罚
- 天梯榜

### 其他

- 键位自定义
- 游戏区域大小自定义

## Something else

- 由于基础代码设计缺陷，目前Game over的判断为顶部两行有放置的方块即为游戏结束。
- 分数计算规则：每次消除n行加(1+2+...+n)分。
- 出现卡方块解决方法：按键盘F8强制刷新（正常情况下请勿使用）
- 作者本人最高分数：200+
- 该程序使用高频循环检测键盘输入，对CPU主频要求较高，CPU主频不足时会出现较大的按键延迟。

## 整体思路

使用纯模拟的思路实现算法。

声明两个bool型二维数组block和src分别用于储存已固定方块和屏幕缓存，使用查表的方式将当前方块叠加到已固定的方块上并储存进屏幕缓存（占了大部分代码量），最后遍历缓存区输出到屏幕。

键盘操作方面先判断是否操作是否有效（是否与已有方块重合或超过边缘），再更新方块的坐标。方块下落完成时将屏幕缓存复制到方块存储区中，并用随机数刷新新的方块。

以上动作使用while循环和Sleep()计时。